(function(e){e.AMB=e.AMB||{};AMB.VERSION="0.2.1"})(window);(function(e){e.AMB=e.AMB||{};AMB.logLevel=AMB.logLevel||"INFO";AMB.config={mode:"sandbox",dev:0,key:{me:"_ambme",token:"_ambt",clientId:"_ambcid",fid:"_ambfid",sessionId:"_ambsid",bootstrap:"_ambbs",app:"_ambapp",storage:"_ambstrg",call:"_ambcall",pr:"_ambpr",logLvl:"_ambloglvl",config:"_ambcfg",recommend:"_ambrmd"},fid:{hlogo:"c.amm-header_l.dr-home_r.am-mini",hnoti:"c.amm-header_l.dr-noti_r.am-mini",hLogin:"c.amm-header-login_l.dr-home_r.am-mini",ftop:"c.amm-footer_l.dr-top_r.am-mini",fhome:"c.amm-footer_l.dr-home_r.am-mini",fcommunity:"c.amm-footer_l.dr-ctop_r.am-mini",fgame:"c.amm-footer_l.dr-gtop_r.am-mini",fnotifications:"c.amm-footer_l.dr-noti_r.am-mini",fcoin:"c.amm-footer_l.dr-coin_r.am-mini",finvitation:"c.amm-footer_l.dr-invitation_r.am-mini",fcontact:"c.amm-footer_l.dr-contact_r.am-mini",fLogin:""},scope:[],url:{home:"https://s.sb-amebame.com",auth:"https://auth.sb-amebame.com",OAuth:"https://oauth.ameba.jp",graph:"https://api.sb-amebame.com/graph","public":"https://api.sb-amebame.com/public",admin:"https://api.sb-amebame.com/operation",recommend:"https://api.sb-amebame.com/recommend",tracking:"https://track.sb-amebame.com",bootstrap:"https://api.sb-amebame.com/bootstrap",stat:"http://stat.sb-amebame.com",stat_ssl:"https://stat.sb-amebame.com",help_rmt:"http://help.amebame.com/ameba-rules/1295/",payment:"https://payment.stg-amebame.com/coin/"},amebame:{url:{home_header:"https://s.sb-amebame.com/#home",top:"https://s.sb-amebame.com/#top",home:"https://s.sb-amebame.com/#home",game:"http://sr.ca-mpr.jp/s/10/?i4a=586886",community:"http://sr.ca-mpr.jp/s/10/?i4a=586887",payment:"https://s.sb-amebame.com/#coin/summary",invitation:"https://s.sb-amebame.com/#invitation",contact:"https://s.sb-amebame.com/#contact/app",group:"https://s.sb-amebame.com/#group",notifications:"https://s.sb-amebame.com/#notifications",models:""}},app:{jssdk:{id:"34082"}}}})(window);(function(e){function s(e){return typeof e=="string"||e instanceof String}function o(e){return typeof e=="function"||e instanceof Function}function u(e){return typeof e=="number"||e instanceof Number}function a(e){return e instanceof T}function f(e){return e instanceof Object}function l(e){return e instanceof Array}function c(e){return e===undefined||e===null}function h(e){for(var t in e)return!1;return!0}function p(e){return c(e)?"":e}function d(e){return e.replace(/-([a-z])/g,function(e){return e.toUpperCase().replace("-","")})}function v(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function m(e,t){return u(t)&&c(r[e])?t+"px":t}function g(e){var t={};for(var n=0;n<e.length;n++)t[e[n]]=1;return t}function y(e){return e?e.replace(/^\s+|\s+$/g,""):""}function b(e){return tag("span").text(e).inner()}function w(e,t,n){if(!n)return;["-webkit-"+t,"-moz-"+t,"-ms-"+t,"-o-"+t,t].forEach(function(t){e[t]=n})}function S(e){return e._cid||(e._cid=++E)}function x(e,t,n){try{var r=new Event(e);r.target=t;return r}catch(i){var s=t instanceof T?t.get(0):null;return{type:e,target:t,currentTarget:s,custom:!0,source:n,stopPropagation:function(){n&&n.stopPropagation()},preventDefault:function(){n&&n.preventDefault()}}}}function T(e,t){s(e)?this.c=t.querySelectorAll(e):l(e)?this.c=e:this.c=[e]}function N(e){return c(e)?null:e instanceof T?e:new T(e,t)}function k(e){return e in C?C[e]:e}function M(e,t,n){this.count=0;this.loop=t||0;this.interval=e||0;this.delay=n||0;this.timerId=0}function D(e,t){var n=(new Error).stack;if(n){var r=n.split(/\n/),i=r[3];if(i){var s=_.exec(i);if(s){var o=s[1];t.push("("+o+")")}}}t.unshift("["+e+"]");N.os.ios||N.os.android?console.log(t.join(" ")):console.log.apply(console,t)}function H(){}var t=e.document,n=e.document.documentElement,r={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},i=Array.prototype.slice,E=0,C={added:"DOMNodeInsertedIntoDocument",removed:"DOMNodeRemovedFromDocument"};T.prototype={constructor:T,length:function(){return this.c.length},exist:function(e){var t=this.c;return e>=0&&e<t.length&&(l(t)?!c(t[e]):!c(t.item(e)))},get:function(e){return l(this.c)?this.c[e]:this.c.item(e)},each:function(e){var t=this.c instanceof Array;for(var n=0;n<this.c.length;n++)t?e.call(this.c[n]):e.call(this.c.item(n));return this},find:function(e){var t=[];this.each(function(){var n=this.querySelectorAll(e),r=n.length;for(var i=0;i<r;i++)t.push(n.item(i))});return N(t)},bound:function(e){var n=this.get(0).getBoundingClientRect(),r=e&&e.screen?0:t.body.scrollLeft,i=e&&e.screen?0:t.body.scrollTop;return{left:Math.floor(n.left+r),right:Math.floor(n.right+r),top:Math.floor(n.top+i),bottom:Math.floor(n.bottom+i),width:Math.floor(n.width),height:Math.floor(n.height)}},css:function(e){var t;if(s(e))return this.get(0).style[d(e)]||getComputedStyle(this.get(0),"").getPropertyValue(e);if(arguments.length===0){t={};this.get(0).style.cssText.split(";").forEach(function(e){var n=e.match(/\s*(.+)\s*:\s*(.+)\s*/);n&&(t[n[1]]=n[2])});return t}t="";var n=e.reset;delete e.reset;for(var r in e){var i=v(r);t+=i+":"+m(r,e[r])+";"}this.each(function(){n?this.style.cssText=t:this.style.cssText+=t});return this},hasClass:function(e){if(!this.exist(0))return undefined;var t=!1;this.each(function(){var n=this.className;t=(" "+p(n)+" ").indexOf(" "+e+" ")>=0;return t});return t},cls:function(e){if(c(e)){var t={};this.each(function(){N.merge(t,g(this.className.split(/\s+/g)))});return t}var n=[],r=[],i=0;s(e)?n=[e]:l(e)?n=g(e):N.map(e,function(e,t){t===1?n.push(e):r.push(e)});this.each(function(){var e=g(this.className.split(/\s+/g));for(i=0;i<n.length;i++){var t=n[i];t&&(e[t]=1)}for(i=0;i<r.length;i++)delete e[r[i]];var s="";N.map(e,function(e){s.length===0?s+=e:s+=" "+e});this.className=s});return this},on:function(e,t,n){e=k(e);this.each(function(){function r(e){var n=e.currentTarget,r=t.call(n,e);return r}r._cb=t;r._uc=n;this.addEventListener(e,r,n);var i=this._handlers||(this._handlers={}),s=i[e]||(i[e]=[]);s.indexOf(r)<0?s.push(r):alert(t)});return this},trigger:function(e,t){e=k(e);var n=this,r=x(e,n,t);this.each(function(){if(r.custom){var t=this._handlers;if(t&&e in t){var i=t[e];i.forEach(function(e){return e.call(n,r)})}}else this.dispatchEvent(r)})},off:function(e,t){e=k(e);this.each(function(){var n=this._handlers;if(n&&e in n){var r,i=n[e];if(t){for(r=0;r<i.length;r++)if(i[r]._cb===t){this.removeEventListener(e,i[r],i[r]._uc);i.splice(r,1);i.length===0&&delete n[e];break}}else{for(r=0;r<i.length;r++)this.removeEventListener(e,i[r],i[r]._uc);delete n[e]}}});return this},text:function(e){var t=arguments.length;if(t===0){var n="";this.each(function(){n+=this.textContent});return n}t>1&&(e=N.format.apply(N,arguments));e=e||"";return this.each(function(){this.textContent=e})},value:function(e){var t=this.get(0);if(e!==null&&e!==undefined){t&&(t.value=e);return this}return t?t.value||"":""},checked:function(){var e=this.get(0);return e.checked||!1},parent:function(){var e=this.get(0);return e?N(e.parentNode):null},append:function(e){if(c(e))return this;var t=N(e),n=this.get(0);n&&t.each(function(){n.appendChild(this)});return this},prepend:function(e){if(c(e))return this;var t=N(e),n=this.get(0);n&&t.each(function(){n.childNodes.length>0&&n.firstChild?n.insertBefore(this,n.firstChild):n.appendChild(this)});return this},replace:function(e,t){if(c(e))return this;var n=N(e),r=this.get(0),i=t.get(0);r&&n.each(function(){r.childNodes.length>0&&i&&i.parentNode==r?r.insertBefore(this,i):r.appendChild(this);r.removeChild(i)});return this},remove:function(){this.each(function(){this.parentNode&&this.parentNode.removeChild(this)});return this},empty:function(){return this.inner("")},html:function(){var e=i.apply(arguments);if(e.length===0){var t="";this.each(function(){this.outerHTML&&(t+=this.outerHTML)});return t}return this.each(function(){this.outerHTML=e[0]})},inner:function(){var e=i.apply(arguments);if(e.length===0){var t="";this.each(function(){this.innerHTML&&(t+=this.innerHTML)});return t}return this.each(function(){this.innerHTML=e[0]})},tag:function(e,t){var n=N.tag(e,t);n._p=this;return n},gat:function(){var e=this._p;delete this._p;return e.append(this)},appendText:function(e){this.append(t.createTextNode(e));return this},attr:function(e,t){var n=this,r;if(e===undefined&&t===undefined){if(arguments.length===1)return this;r=n.get(0);var i={};if(r&&r.attributes){var o=r.attributes.length;for(var u=0;u<o;u++){var a=r.attributes[u];i[a.name]=a.value}}return i}if(t===undefined&&f(e))for(var l in e)n.attr(l,e[l]);else{if(s(e)&&t===undefined){r=n.get(0);return r.hasAttribute(e)?r.getAttribute(e):undefined}this.each(function(){c(t)?this.removeAttribute(e):e==="cls"?n.cls(t):this.setAttribute(e,t)})}return this},data:function(e,t){var n=this,r;if(arguments.length===0){var i=this.attr(),o={};for(r in i)r.indexOf("data-")===0&&(o[r.substring(5)]=i[r]);return o}if(arguments.length===1){if(s(e))return this.attr("data-"+e);var u={};for(r in e)u["data-"+r]=e[r];this.attr(u)}else this.attr("data-"+e,t);return this},tap:function(e){var n=this;if(e){n.on("tap",function(t){return e.call(this,t)});if(N.os.touch){var r=null;n.on("touchstart",function(e){r=N(this);r.__tap={};var n=e.changedTouches[0];r.__tap.x=n.clientX;r.__tap.y=n.pageY+t.body.scrollTop}).on("touchmove",function(e){var n=e.changedTouches[0];r.__tap.toX=n.clientX;r.__tap.toY=n.pageY+t.body.scrollTop;var i=r.__tap;if(!(Math.abs((i.toX||i.x)-i.x)<=10&&Math.abs((i.toY||i.y)-i.y)<=10)){r.trigger("tapout",e);return!1}}).on("touchend",function(e){e.preventDefault();e.stopPropagation();var t=r.bound(),n=e.changedTouches[0],i=n.clientX-t.left,s=n.pageY-t.top,o=r.__tap;i>=0&&Math.abs((o.toX||o.x)-o.x)<=5&&Math.abs((o.toY||o.y)-o.y)<=5&&i<=t.width&&s>=0&&s<=t.height&&!r.attr("disabled")&&r.trigger("tap",e);delete r.__tap;r=null})}else n.click(function(e){N(this).trigger("tap",e)})}else n.trigger("tap");return n},over:function(e){function n(e){N(this).trigger("over",e)}var t=this;t.on("over",function(t){var n=this;n.__over=!0;e.call(n,t)});N.os.touch?e?t.on("touchstart",n):n():t.mouseover(n);return t},tapout:function(e){var t=this;t.on("tapout",function(t){var n=this;e.call(n,t)});return t},out:function(e){function n(e){N(this).trigger("out",e)}var t=this;t.on("out",function(t){var n=this;if(n.__over){delete n.__over;e.call(n,t)}});N.os.touch?e?t.on("touchend",n):n():t.mouseout(n);return t},visible:function(e){return this.css({visibility:e?"visible":"hidden"})},disable:function(){function t(e){e.preventDefault()}var e=this;["touchstart","touchend","touchmove","mouseover","mouseout","mousedown","mouseup"].forEach(function(n){e.on(n,t)});return e}};["click","blur","change","error","focus","keydown","keyup","keypress","load","unload","mousedown","mouseup","mousemove","mouseout","mouseover","resize","scroll","select","submit","touchstart","touchmove","touchend"].forEach(function(e){T.prototype[e]=function(t){t?this.on(e,t):this.trigger(e);return this}});var L=navigator.userAgent;N.os={ua:L,touch:"ontouchstart"in document.documentElement,ios:/ip(hone|od|ad)/i.test(L),iphone:/iphone/i.test(L),ipad:/ipad/i.test(L),android:/android/i.test(L),mobile:/android.+mobile|ip(hone|od|ad)/i.test(L),webkit:/webkit/i.test(L)};var A={},O={};N.tag=function(e,n){n=n||{};var r=e.indexOf("#"),i=e.indexOf(".");r>0&&(i>0?n.id=e.substring(r+1,i):n.id=e.substring(r+1));if(i>0){var s=e.substring(i+1).split(".");for(var o=0;o<s.length;o++){var u=s[o];n.cls?n.cls+=" "+u:n.cls=u}}e=r>0?e.substring(0,r):i>0?e.substring(0,i):e;var a=t.createElement(e),f=N(a).attr(n);return f};N.fragment=function(){return N(document.createDocumentFragment())};N.extend=function(e){N.map(e,function(e,t){T.prototype[e]=t})};N.map=function(e,t){if(!e)return;for(var n in e)e.hasOwnProperty(n)&&t.call(e,n,e[n])};N.cookie=function(e,t,n){var r;if(arguments.length===1){var i=document.cookie.split(";");for(var s=0;s<i.length;s++){r=i[s];var o=r.indexOf("="),u=y(r.substring(0,o));if(e===u)return y(r.substring(o+1))}return undefined}r=e+"="+escape(t?t:"");var a=null;if(n){a=new Date;a.setDate(a.getDate()+n)}else t||(a=new Date(0));a&&(r+="; expires="+a.toUTCString());document.cookie=r};N.session=function(e,t){if(arguments.length===1){var n=sessionStorage.getItem(e);return n?JSON.parse(n):null}c(t)?sessionStorage.removeItem(e):sessionStorage.setItem(e,JSON.stringify(t));return this};N.storage=function(e,t){if(arguments.length===1){var n=localStorage.getItem(e);return n?JSON.parse(n):null}c(t)?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t));return this};N.format=function(){var e=arguments;return e[0]?e[0].replace(/\{(\d+)\}/g,function(){return e[arguments[1]]}):null};N.format.digit=function(e,t){e=String(e);if(e==="")return e;var n=e.length;if(n>=t)return e;var r=t-n,i="";for(var s=0;s<r;s++)i+="0";return i+e};N.listenize=function(e){e.prototype.on=function(t,n){P.info("listening",e.name,t);if(f(t))for(var r in t)this.on(r,t[r]);else{this._events||(this._events={});var i=this._events[t];i?i.push(n):this._events[t]=[n]}return this};e.prototype.off=function(t,n){P.info("listening off",e.name,t);var r=this;if(arguments.length===1)delete this._events[t];else if(typeof handler=="function"){var s=this._events[t];if(s){var o=s.indexOf(n);if(o>=0){s.splice(o,1);s.length===0&&delete this._events[t]}}}else{var u=i.apply(arguments);u.forEach(function(e){r.off(e)})}return this};e.prototype.trigger=function(){if(!this._events)return;var t=i.apply(arguments),n=t.shift();P.debug("triggering",e.name,n,t);var r=this._events[n];if(r)for(var s=0;s<r.length;s++){var o=r[s].apply(this,t);if(o===!1||o===1)return!1}return!0}};M.prototype={lastTap:null,paused:!1,executedTime:0,pastFromPrev:0,start:function(){var e=this;e.paused=!1;e.delay>0?e.timerId=setTimeout(function(){e.next()},e.delay):e.next();return e},next:function(){var e=this;if(e.end)return;if(e.paused)return;e.count++;e.executedTime=(new Date).getTime();e.trigger("timer");if(e.loop>0&&--e.loop===0)return;e.timerId=setTimeout(function(){e.next()},e.interval)},pause:function(){this.paused=!0;this.pastFromPrev=(new Date).getTime()-this.executedTime;clearTimeout(this.timerId)},resume:function(){var e=this;this.paused=!1;this.timerId=setTimeout(function(){e.next()},e.interval-e.pastFromPrev)},stop:function(){var e=this;e.end=!0;clearTimeout(e.timerId);return e}};N.listenize(M);N.timer=function(e,t,n){return new M(e,t,n)};N.now=function(){return(new Date).getTime()},N.parseQuery=function(e){if(e===null)return!1;var e=e||location.search;if(!e){var t=location.href,n=t.indexOf("?");e=t.substring(n+1)}e.charAt(0)==="?"&&(e=e.substring(1));var r={},i=e.split("&");for(var s=0;s<i.length;s++){var o=i[s],n=o.indexOf("="),u=[o.substring(0,n),o.substring(n+1)];u.length===2&&(r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]))}return r};N.createQuery=function(e){var t="";for(var n in e)t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";return t.slice(0,-1)};N.parseHash=function(e){var e=e||location.hash;if(!e)return!1;e.charAt(0)==="#"&&(e=e.substring(1));var t={},n=e.split("&");for(var r=0,i=n.length;r<i;r++){var s=n[r].split("=");s.length===2?t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):s.length===1&&(t[decodeURIComponent(s[0])]="")}return t};var _=new RegExp("/([^/]+?:[0-9]+):"),P={debug:function(){D("DEBUG",i.apply(arguments))},info:function(){D("INFO",i.apply(arguments))},warn:function(){D("WARN",i.apply(arguments))},error:function(){D("ERROR",i.apply(arguments))},fatal:function(){D("FATAL",i.apply(arguments))}};N.log=P;N.setLogLevel=function(e){switch(e){case"FATAL":P.error=H;case"ERROR":P.warn=H;case"WARN":P.info=H;case"INFO":P.debug=H;default:}};N.isString=s;N.isObject=f;N.isFunction=o;N.isNumber=u;N.isArray=l;N.isNull=c;N.isEmptyObject=h;e.AMB.chikuwa=N})(window);(function(e){function i(){var e=navigator.userAgent.match(/(OS|Android) ([0-9_\.]+){1,3}/);return parseInt((RegExp.$2.replace(/_|\./g,"")+"00").slice(0,3))}function s(e){for(var n in localStorage)n.indexOf(e)!==-1&&t.storage(n,null)}function o(e){for(var n in sessionStorage)n.indexOf(e)!==-1&&t.session(n,null)}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config,r=t.session(n.key.logLvl)||{};AMB.logLevel=r.value||AMB.logLevel;t.setLogLevel(AMB.logLevel);t.os.version=i();AMB.chikuwa.storage=function(e,n,r){if(arguments.length===1){var i=localStorage.getItem(e);return i?JSON.parse(i):null}if(t.isNull(n))localStorage.removeItem(e);else try{localStorage.setItem(e,JSON.stringify(n))}catch(o){if(o.name!=="QUOTA_EXCEEDED_ERR")throw o;s(r||"_amb")}return this};AMB.chikuwa.session=function(e,n,r){if(arguments.length===1){var i=sessionStorage.getItem(e);return i?JSON.parse(i):null}if(t.isNull(n))sessionStorage.removeItem(e);else try{sessionStorage.setItem(e,JSON.stringify(n))}catch(s){if(s.name!=="QUOTA_EXCEEDED_ERR")throw s;o(r||"_amb")}return this};AMB.chikuwa.cache=function(){var e,n,r;if(arguments.length===1){n=t.storage(arguments[0])||{};if((new Date).getTime()<n.expireIn)return n.data;t.storage(arguments[0],null);return!1}if(arguments.length===2)t.storage(arguments[0],null);else if(arguments.length===3){e=arguments[0];n=arguments[1];r=arguments[2];t.storage(e,{expireIn:(new Date).getTime()+r,data:n})}return!1};t.extend({button:function(e,n){var r=this,i=n&&"isTapout"in n&&n.isTapout;this.over(function(e){t(this).cls({amb_tap:1})}).tapout(function(e){i&&t(this).cls({amb_tap:-1})}).out(function(){i||t(this).cls({amb_tap:-1})}).tap(e).css({cursor:"pointer","-webkit-user-select":"none"});return this}})})(window);(function(e){function s(e){var r={client_id:e.clientId||t.storage(n.key.clientId)&&t.storage(n.key.clientId).value||"",response_type:e.response_type||"token",scope:e.scope?e.scope.join(","):n.scope.join(",")};e.state&&(r.state=e.state);r.response_type==="token"&&(r.redirect_uri=encodeURI(location.href));t.session(n.key.fid)&&(r.frm_id=t.session(n.key.fid).value);e.provider_id&&(r.provider_id=e.provider_id);return r}function o(e){var e=e||"access_token";if(t.storage(n.key.storage)){var s=t.storage(n.key.token);i.debug("Get token from storage",s&&s[e]);return s&&s[e]}i.debug("Get token from memory",r[e]);return r[e]}function u(e){if(!e)return!1;if(t.storage(n.key.storage)){i.debug("Set token in storage",e.access_token);t.storage(n.key.token,e)}else{i.debug("Set token on memory",e.access_token);r=e}return!0}function a(){if(t.storage(n.key.storage)){i.debug("Remove token from storage");t.storage(n.key.token)&&t.storage(n.key.token,null);return!0}i.debug("Remove token from memory");r={};return!0}function f(e){var r=n.url.auth+"/authorize?"+t.createQuery(e);return r}function l(e,r,s){function f(e){var n=document.createElement("a");n.href=e;e+=n.search?"&":"?";e+="from=jssdk";t.os.android&&(e+="&now="+(new Date).getTime());return e}function l(){i.debug("HTTP open",e,r);a.open(e,r);var u=s?JSON.stringify(s):null,f=o(),l=t.storage(n.key.clientId),c=t.storage(n.key.sessionId);f&&a.setRequestHeader("Authorization","OAuth "+f);l&&a.setRequestHeader("X-ClientId",l.value);c&&a.setRequestHeader("X-SessionId",c.value);i.debug("XHR send",u,a);a.send(u)}i.debug("HTTP",e,r);var u=this,a=u.xhr=new XMLHttpRequest;r=f(r);var c=t.os.android?3e3:1e4,h=0;a.timerId=setTimeout(function(){i.debug("HTTP timeout",e,r);a.abort();u.trigger("loaded",a);u.trigger("error",{code:"timeout",message:"timeout"})},c);a.onreadystatechange=function(){if(h===4)return;var s=a.readyState;h=s;i.debug("xhr state",s,s===4);if(s===4){var o=a.status;i.debug("xhr status",o,e,r,a.responseText);if(o===0){i.debug("xhr status aborted");return}clearTimeout(a.timerId);var f;i.debug("xhr response text",a.responseText);a.responseText.charAt(0)==="{"?f=JSON.parse(a.responseText):f=a.responseText;i.debug("xhr response object",f);var l;if(200<=o&&o<300){i.debug("HTTP OK",e,r,a);l="complete"}else{i.error("HTTP",a.statusText,e,r);t.session(n.key.bootstrap)&&t.session(n.key.bootstrap,null);l="error"}u.trigger(l,f)}else if(s<4){var c=["init","loading","loaded","interactive"][s];i.debug("HTTP state type",c,e,r);u.trigger(c,a)}};setTimeout(l,0)}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config,r={},i=t.log;AMB.configure=function(e){i.debug("Begin to configure");var e=e||{},r=t.storage(n.key.clientId)||{},s=e.clientId||"",a=o(),f=e.token||"",l=e.storage?e.storage:0,c=e.sessionId||"",h=e.redirectUrl||"";if(l)t.storage(n.key.storage,{value:!0});else{t.storage(n.key.storage)&&t.storage(n.key.storage,null);t.storage(n.key.token)&&t.storage(n.key.token,null)}s&&r.value!==s&&t.storage(n.key.clientId,{value:s});f&&a!==f&&u({access_token:f});e.scope&&(AMB.config.scope=e.scope);c&&t.storage(n.key.sessionId,{value:c});var p={redirectUrl:h};t.storage(n.key.config,p)};AMB.bootstrap=function(){i.debug("Begin to bootstrap");if(!t.cache(n.key.call)){var e=new Date,r=e.getTime(),s=6e4*(60-e.getMinutes(r))-e.getSeconds(r)*1e3;t.cache(n.key.call,{},s);AMB.track.action({name:"call"})}var u=Array.prototype.slice.apply(arguments),a={},f=function(){};for(var l=0,c=u.length;l<c;l++)t.isFunction(u[l])?f=u[l]:t.isObject(u[l])&&(a=u[l]);var h=o();if(h){i.debug("Bootstrap, has token");var p=n.url.graph+"/me?fields=id,gender";t.http.get(p).on({complete:function(e){i.info("bootstrap, authorized");var e=e||{};e.me=e.me||{};var r={g:e.me.gender?1:0};i.debug("set owner data",r);t.storage(n.key.me,r);t.session(n.key.me,{status:{auth:1}});t.session(n.key.bootstrap)?f({auth:1,bootstrap:{associated:1}}):AMB.bootstrapApi(a,function(e){f({auth:1,bootstrap:e})})},error:function(e){i.info("bootstrap, NOT authorized");f({auth:0})}})}else{i.info("bootstrap, no token");f({auth:0})}};AMB.status=function(e){if(!o()){i.debug("User Status, NOT authorized because of not having token");e({auth:0});return}var r=n.url.graph+"/me?fields=id";t.http.get(r).on({complete:function(t){i.debug("User Status, authorized");e({auth:1})},error:function(t){i.debug("User Status, NOT authorized",t.status,t.message);e({auth:0})}})};AMB.logout=function(e){var e=e||o(),r=function(){i.error("Logout failed")};e||r();t.storage(n.key.me,null);t.session(n.key.me,null);a();var s=n.url.home+"/logout",u={access_token:e,callback:location.href};s+="?"+t.createQuery(u);location.href=s};AMB.authorize=function(e){var e=e||{},t=s(e);i.debug("Redirect to authorize",f(t));location.href=f(t)};t.listenize(l);t.http={get:function(){var e=Array.prototype.slice.apply(arguments),t=e[0],n=e[1];if(e.length===3){t=t+"?"+query(e[1]);n=e[2]}return new l("GET",t,null,n)},post:function(e,t,n){return new l("POST",e,t,n)},put:function(e,t,n){return new l("PUT",e,t,n)},del:function(e,t){return new l("DELETE",e,t)}};var c=t.parseHash();if(c.access_token){i.debug("Catch a token from the query?",c.access_token);var h={};h.access_token=c.access_token;u(h)&&(t.storage(n.key.storage)&&t.storage(n.key.storage).value?location.replace(location.protocol+"//"+location.host+location.pathname):location.hash="")}})(window);(function(e){function r(e){var t=n.url.graph+e;return t}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config;AMB.api=function(e,n){var i=r(e);t.http.get(i).on({complete:function(e){n(e)},error:function(e){n(null,e)}})};AMB.api.get=AMB.api;AMB.api.post=function(e,n,i){var s=r(e);t.http.post(s,n).on({complete:function(e){i(e)},error:function(e){i(null,e)}})};AMB.api.put=function(e,n){var i=r(e);t.http.put(i).on({complete:function(e){n(e)},error:function(e){n(null,e)}})};AMB.api.del=function(e,n){var i=r(e);t.http.del(i).on({complete:function(e){n(e)},error:function(e){n(null,e)}})}})(window);(function(e){function r(e,r){var i=n.url.bootstrap+"/associate",s={};e.hasOwnProperty("visible")&&(s.visible=e.visible);var o=e.fid||t.session(n.key.fid)&&t.session(n.key.fid).value;o&&(s.fid=o);t.isEmptyObject(s)||(i+="?"+t.createQuery(s));t.log.info("Bootstrap API, begin to associate",i);t.http.post(i).on({complete:function(e){t.log.info("Bootstrap API, associated");t.session(n.key.bootstrap,{associated:1});r({associated:1})},error:function(){r({associated:0})}})}function i(){var e=t.storage(n.key.config)&&t.storage(n.key.config).redirectUrl||location.href,r={callback:e};t.log.info("Bootstrap API, begin to register",r);location.href=n.url.home+"/#register?"+t.createQuery(r)}function s(e,s,o){switch(e){case"unregistered":i();break;case"unassociated":r(s,o);break;default:t.session(n.key.bootstrap,{associated:1});o({associated:1})}}function o(e){var r=n.url.bootstrap;t.http.get(r+"/status").on({complete:function(n){t.log.debug("Bootstrap status",n);e(n)},error:function(t){e(null,t)}})}function u(e,t){e=e||{};var n=[];o(function(r){if(!r){t({associated:0});return}for(var i in r)n.push(i);s(n.shift(),e,t)})}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config;AMB.bootstrapApi=u})(window);(function(e){function i(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config;AMB.track={action:function(e,t){e=e||{};var n=e.name||"",i=e.option||"",s=e.vars||{};return(new r(n,i,s)).track(t)},access:function(e){if(!t.cache(n.key.call)){var r=new Date,i=r.getTime(),s=6e4*(60-r.getMinutes(i))-r.getSeconds(i)*1e3;t.cache(n.key.call,{},s);AMB.track.action({name:"call"},e)}else e&&e(null,{})}};var r=function(e,n,r){this.name=e||"";this.vars=r||{};n&&(t.isString(n)?this.option=n:t.isArray(n)&&(this.option=n.join(",")))};r.prototype={track:function(e){var r=this,i=r.createParams(),s=t.createQuery(i),o=n.url.tracking+"/track/log?"+s;try{t.http.get(o).on({complete:function(){t.log.info("tracking OK",i);t.isFunction(e)&&e(null,i)},error:function(n){t.log.info("tracking ERROR",i);t.isFunction(e)&&e(n,i)}})}catch(u){t.log.info("tracking ERROR",u)}},createParams:function(){var e=t.session(n.key.fid)||{},r={action:this.name,tz:(new Date).getTimezoneOffset(),lang:navigator.language,platform:navigator.platform,referrer:document.referrer,url:location.href,option:this.option||"",fid:e.value||"",var1:this.vars.var1||"",var2:this.vars.var2||"",var3:this.vars.var3||"",var4:this.vars.var4||"",var5:this.vars.var5||""};return r}};t.storage(n.key.sessionId)||t.storage(n.key.sessionId,{value:i()});var s=t.parseQuery();s&&s.frm_id&&t.session(n.key.fid,{value:s.frm_id})})(window);(function(e){function p(){return t.storage(r.key.app)&&t.storage(r.key.app).data&&t.storage(r.key.app).data.application?t.storage(r.key.app).data.application.id:""}function d(e){return e+"-"+p()}function v(e,n){function i(e,n){for(var r in n)e[r]?e[r]=e[r]+"_"+n[r]:e[r]=n[r];return t.createQuery(e)}if(!e)return!1;if(!n)return e;var r=document.createElement("a");r.href=e;if(r.host==="link.ameba.jp"){r.pathname+=t.createQuery(n);return r.href}if(r.search){r.search=i(t.parseQuery(r.search),n);return r.href}r.search=t.createQuery(n);return r.href}function b(e){var n=t.session(r.key.me)||{},i=n.status||{};i.auth?e(i):AMB.status(function(i){n.status=i;t.session(r.key.me,n);e(i)})}function w(e,n){var i=r.url.public+"/application/"+e,s=t.cache(r.key.app)||{};s.application?n(s):t.http.get(i).on({complete:function(e){t.cache(r.key.app,e,h);n(e)},error:function(e){n(null,e)}})}function E(){var e=t.storage(r.key.app)&&t.storage(r.key.app).data&&t.storage(r.key.app).data.application||{};return e.device&&e.device.web&&e.device.web.path&&e.device.web.path.login?e.device.web.path.login:""}function S(e){var n=m(r.key.recommend);if(n)e(n);else{var i={},s=r.url.recommend+"/app/app?limit=4";t.http.get(s).on({complete:function(t){i.recommend=t;var n=i.recommend.data.length;i.recommend.data.forEach(function(t){AMB.api("/"+t.id+"?fields=picture,device",function(s){--n;t.url=s&&s.device&&s.device.web&&s.device.web.url;t.picture=s&&s.picture||"";if(n===0){m(r.key.recommend,i,h);e(i)}})})},error:function(t){i.recommend={};e(i,t)}})}}function x(e){var n=m(r.key.pr);if(n)e(n);else{var i={},s=p(),o=function(e){if(!r.path[e])return!1;var t=r.url.admin+r.path[e];s&&(t+="&app_id="+p());return t},u=o("footerText");t.http.get(u).on({complete:function(t){i.footerText=t.data;m(r.key.pr,i,l*15);e(i)},error:function(t){e(i,t)}})}}function T(e){function a(e){if(!(e&&e.body&&e.target))return!1;var t=e.body.portalTo,n=t==="game"?r.amebame.url.game:r.amebame.url.community,i={frm_id:d(r.fid["f"+t],p())};e.target.mapping&&(i.pickup_id=e.id);return v(n,i)}e=e||{};var n={},s,o,u;if(e.footerText){s="new";e.footerText.body.options&&(s=t.isObject(e.footerText.body.options)?e.footerText.body.options[0]:e.footerText.body.options);n.footerText={icon:"amb_"+s,text:e.footerText.body.message[i],link:e.footerText.body.link}}e.pickUpText&&(n.pickUpText={category:e.pickUpText.body.portalTo,link:a(e.pickUpText),message:e.pickUpText.body.message[i]});return n}function N(e){function s(e,t){e||(e="");return e.indexOf(t)>=0}function o(e,t){return e.target.appId===t.appId}function u(e,t){return s(e.target.devices,t.device)}function a(e,t){return t.gender?s(e.target.genders,t.gender):!0}function f(e){return e.target.portal?e.target.portal.indexOf("mini")>=0:!0}function l(e,n){if(!(e&&e.target&&e.target.time))return!1;var r=t.date.parseISO8601(e.target.time.start).getTime(),i=t.date.parseISO8601(e.target.time.end).getTime(),n=n||(new Date).getTime();return r<=n&&n<i}function c(e,n){var r=a(e,n)&&u(e,n)&&!o(e,n)&&l(e)&&f(e);t.log.debug("PR isMatch",r,a(e,n),u(e,n),!o(e,n),l(e),f(e),e,n);return r?!0:!1}function h(e){var e=e||[],r=[];e.forEach(function(e){c(e,n)&&r.push(e)});var i=r[parseInt(Math.random()*r.length)]||"";t.log.debug("selected",i);return i}e=e||{};var n={};n.gender=t.storage(r.key.me)?t.storage(r.key.me).g||"":"";n.gender===0?n.gender="female":n.gender===1&&(n.gender="male");t.os.caApp?n.device=t.os.ios?"iosApp":t.os.android?"androidApp":"":n.device=t.os.ios?"ios":t.os.android?"android":"";t.storage(r.key.me)&&t.storage(r.key.me).app&&t.storage(r.key.me).app.id?n.appId=t.storage(r.key.me).app.id:n.appId=null;var i={};i.fun=h(e.fun);i.footerText=h(e.footerText);i.pickUpText=h(e.pickUpText);return i}function C(){b(function(e){e.auth?k(function(e){if(!e){s.stop();return}g.header&&O.header.update({noti:e});g.footer&&O.footer.update({noti:e})}):s&&s.stop()})}function k(e){AMB.api("/me/notifications?summaryOnly=true",function(t){t?e(t):e(null)})}function L(){if(s)return;C();s=t.timer(r.noti.interval,0,r.noti.interval);s.on("timer",function(){C()});s.start()}function A(){var e={};x(function(t){e.pr=T(N(t));S(function(t){e.recommend=t.recommend;O.footer.update(e)})})}if(!AMB)return;var t=AMB.chikuwa,n=t.tag,r=AMB.config,i="ja",s="",o={ja:{contact:"お問い合わせ",models:"対応端末",payment:"コインを購入",invite:"友だち招待",top:"Ameba",home:"ホーム",game:"ゲーム",community:"コミュニティ",notifications:"お知らせ",noNoti:"お知らせはありません",close:"閉じる",more:"もっと見る",loading:"読み込み中...",login:"ログイン",service:"サービス",search:"探す",all:"すべての",help:{top:"ヘルプ",rmt:"禁止行為について"},common:{to:"{1}へ",execute:"{1}する",auxiliary:{ni:"{1}に",kara:"{1}から"}},date:{format:{MD:"{1}月{2}日"}},naviLove:{title:"新作の恋だけあつめました。"},recoApp:{forYou:"を使っている人に",title:"おすすめのサービス"}}},u=function(){var e=window.devicePixelRatio||1;return e>1.5?2:e>1?1.5:1}();r.noti={};r.noti.interval=r.dev?1e4:18e4;r.path={fun:"/frames?type=fun&location=footer",footerText:"/frames?type=text&location=footer",pickUpText:"/frames?type=app&location=general_pickup"};t.os.caApp=/CaWebApp/i.test(t.os.ua);t.os.iosCaApp=t.os.ios&&t.os.caApp;var a=t.storage(r.key.clientId)?t.storage(r.key.clientId).value:"";AMB.ui=function(){var e=Array.prototype.slice.apply(arguments),t=e.shift();return y[t].init.apply(y[t],e)};AMB.footer=function(e,t){AMB.ui("footer",e,t)};AMB.header=function(e,t){AMB.ui("header",e,t)};var f=1e3,l=6e4,c=l*60,h=c*24;t.date={parseISO8601:function(e,t){if(!e)return null;if(typeof t=="undefined"){var n=(new Date).getTimezoneOffset()*-1/60;t=Number(n)}e=e.replace(/Z|T/g,"");var r=c*t,i=e.match(/([\d]{4})-([\d]{2})-([\d]{2}).*([\d]{2}):([\d]{2}):([\d]{2})/),s={y:Number(i[1]),m:Number(i[2]),d:Number(i[3])},o={h:Number(i[4]),m:Number(i[5]),s:Number(i[6])},u=new Date(s.y,s.m-1,s.d,o.h,o.m,o.s);r!==0&&u.setTime(u.getTime()+r);return u}};var m=t.cache,g={footer:0,header:0},y={header:{init:function(e,n){if(!t(e))return!1;var r=this,i=this.options(n);this.data(function(t){O.header.init(e,i,t)})},options:function(e){e=e||{};e.template="amb_"+(e.template||"default");e.prepend=t.isNull(e.prepend)?1:e.prepend;e.loginBtn=t.isNull(e.loginBtn)?1:e.loginBtn;return e},data:function(e){var t=this,n={};b(function(t){n.status=t||{};w(a,function(t){n.app=t;e(n)})})}},footer:{init:function(e,n){if(!t(e))return!1;var r=this;this.opts=this.options(n);this.data(function(t){O.footer.init(e,r.opts,t)})},data:function(e){var t=this,n={};n.naviLove={data:[{image:"/pub/content/{1}/img/love/thumb_130521_1.jpg",link:"http://sr.ca-mpr.jp/s/10/?i4a=634333",title:{ja:"戦国武将と恋"}},{image:"/pub/content/{1}/img/love/thumb_130521_2.jpg",link:"http://sr.ca-mpr.jp/s/10/?i4a=634332",title:{ja:"王子様と恋"}},{image:"/pub/content/{1}/img/love/thumb_130521_3.gif"
,link:"http://sr.ca-mpr.jp/s/10/?i4a=634331",title:{ja:"イケメンと恋"}},{image:"/pub/content/{1}/img/love/thumb_130521_4.jpg",link:"http://sr.ca-mpr.jp/s/10/?i4a=634334",title:{ja:"オトナと恋"}}]};b(function(t){n.status=t||{};w(a,function(t){n.app=t;e(n)})})},options:function(e){e=e||{};e.util=t.isNull(e.util)?1:e.util;e.actions=t.isNull(e.actions)?1:e.actions;e.payment=t.isNull(e.payment)?1:e.payment;e.invite=t.isNull(e.invite)?1:e.invite;e.banner=t.isNull(e.banner)?1:e.banner;e.bar=t.isNull(e.bar)?1:e.bar;e.copy=t.isNull(e.copy)?1:e.copy;e.overrideUrls=e.overrideUrls||{};e.loginBtn=t.isNull(e.loginBtn)?1:e.loginBtn;var n=t.cache(r.key.app)||{},i="community";n.application&&(i=n.application.category||i);e.category==="game"&&(i="game");e.category=i;var s;if(!t.isNull(e.invitationUrl)&&e.invitationUrl.match(/^http(s)?(:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)$/))s=e.invitationUrl;else{s=r.amebame.url.invitation+"/external/app/"+a;s+="?callback="+encodeURI(location.href)}s=v(s,{frm_id:d(r.fid.finvitation)});e.invitationUrl=s;e.naviLove=t.isNull(e.naviLove)?0:e.naviLove;e.naviLove&&(e.banner=0);return e}}},O={header:{init:function(e,r,i){g.header=1;this.parent=t(e);this.opts=r;this.data=i;this.container=n("header#amb_header");this.btnNoti=n("button#amb_noti").cls("amb_button");this.notiCounter=n("span.amb_header_noti_counter");this.loginBtn=n("p#amb_header_login");this.render()},render:function(){var e=this,s=this.opts,u=this.data;u.app=u.app||{};var f=this.container;f.cls(s.template+" amb");var l=n("p#amb_ci").tag("a.amb_anchor amb_ci_text").button().attr({href:v(r.amebame.url.home_header,{frm_id:d(r.fid.hlogo)})}).text(t.format(o[i].common.to,o[i].home)).gat();this.btnNoti.button(function(){location.href=v(r.amebame.url.notifications,{frm_id:d(r.fid.hnoti)})});var c=function(){var t=e.loginBtn,n=E(a);if(n){n=v(n,{callback:location.href,frm_id:d(r.fid.hLogin)});t.tag("a.amb_anchor amb_button").attr({href:n}).text(o[i].login).button().gat()}else t=null;return t}();f.append(l);if(u.status.auth){this.btnNoti.append(this.notiCounter.visible(0));f.append(this.btnNoti)}else s.loginBtn&&c&&f.append(c);s.prepend?this.parent.prepend(f):this.parent.append(f);u.status.auth&&L()},update:function(e){e=e||{};var t=this;e.noti&&this.setNotiSummary(e.noti)},deleteCounter:function(){this.notiCounter.text("").visible(0)},setNotiSummary:function(e){t.log.debug("Call header setNotiSummary");var n=this;if(e.summary&&e.summary.unreadCount){var r=e.summary.unreadCount>=10?"+":e.summary.unreadCount;this.notiCounter.text(r).visible(1)}else this.deleteCounter()}},footer:{init:function(e,r,i){var s=this;g.footer=1;this.parent=t(e);this.opts=r;this.data=i;this.noti;this.container=n("div#amb_footer").cls("amb");this.recoApp=n("div#amb_footer_recommend");this.prText=n("div#amb_footer_pr_box");s.render()},update:function(e){e=e||{};var t=this;e.recommend&&this.addRecoItems(this.recoApp,e.recommend);e.pr&&this.addPrText(this.prText,e.pr);e.noti&&this.setNotiSummary(e.noti)},render:function(){var e=this,s=this.opts,f=this.data,l=this.parent,c=this.container,h=function(){var e=n("ul#amb_footer_utility");if(a){var t=s.overrideUrls.inquiry||r.amebame.url.contact+"/"+a;e.tag("li.amb_utility_item").tag("a.amb_anchor amb_tx_link").button().attr({href:v(t,{frm_id:d(r.fid.fcontact,p()),callback:encodeURI(location.href)})}).text(o[i].contact).gat().gat()}s.overrideUrls.help&&e.tag("li.amb_utility_item").tag("a.amb_anchor amb_tx_link").button().attr({href:s.overrideUrls.help}).text(o[i].help.top).gat().gat();if(s.category==="game"){var u=s.overrideUrls.rmt||r.url.help_rmt;e.tag("li.amb_utility_item").tag("a.amb_anchor amb_tx_link").button().attr({href:u}).text(o[i].help.rmt).gat().gat()}return e}(),m=function(){var e=n("ul#amb_footer_usr_action"),t=n("li.amb_action_item");t.tag("button#amb_footer_btn_coin").cls("amb_button").text(o[i].payment).button(function(){var e=r.url.payment;location.href=e}).gat();s.payment&&e.append(t);if(a&&s.invite){var u=n("li.amb_action_item");u.btn=n("button#amb_footer_btn_friend").cls("amb_button").text(o[i].invite);u.append(u.btn);u.btn.button(function(){location.href=s.invitationUrl});e.append(u)}return e}(),g=function(){var t=f.pr&&f.pr.footerText||"",r=n("div#amb_footer_pr_box");return e.prText}(),y=function(){return e.recoApp}(),b=function(){var e=f.naviLove.data,s=n("div#amb_naviLove").cls("amb_container amb_frame"),a=n("p.amb_sc_h").text(o[i].naviLove.title),l=n("ul");e.forEach(function(e){var s=location.protocol==="https:"?r.url.stat_ssl:r.url.stat;s+=t.format(e.image,r.app.jssdk.id)+"?option=crop&size="+60*u;l.append(n("li").tag("a.amb_anchor").button().attr({href:e.link+d("&frm_id=c.amm-footer_l.dr-love-char_r.am-mini")}).tag("i").css({"background-image":"url("+s+")"}).cls("amb_thumbnail amb_smaller amb_app").gat().tag("p.amb_tx_link").text(e.title[i]).gat().gat())});var c=n("a.amb_more_link amb_more amb_anchor").attr({href:"http://sr.ca-mpr.jp/s/10/?i4a=623738"+d("&frm_id=c.amm-footer_l.dr-love-char_r.am-mini")}).button().tag("span.amb_text").text(o[i].more).gat();s.append(a).append(l).append(c);return s}(),w=function(){function i(e){if(!e.category)return;t("#amb_nav .amb_nav_item.amb_"+e.category+" > a").attr({href:r.link})}var e=n("div.pickUpTextWrap"),r=f.pr&&f.pr.pickUpText||"";if(r){e.tag("div#amb_footer_pickUpText").cls("amb_"+r.category).button().tag("a.amb_anchor amb_message").attr({href:r.link}).text(r.message).gat().gat();i(r)}return e}(),S=n("div#amb_navWrap"),x=function(){var e=n("nav#amb_nav"),t=n("ul.amb_nav_list"),s=["home","game","community","notifications"];s.forEach(function(e){var s=n("li.amb_nav_item amb_"+e).tag("a.amb_anchor").button().attr({href:v(r.amebame.url[e],{frm_id:d(r.fid["f"+e])})}).tag("span.amb_label").text(o[i][e]).gat().gat();e==="notifications"&&s.tag("span.amb_footer_nav_counter").visible(0).gat();t.append(s)});e.append(t);return e}(),T=n("p#amb_copyright").text("© CyberAgent, Inc."),N=function(){var e,s=E(a);if(s){s=v(s,{callback:location.href,frm_id:d(r.fid.hLogin)});e=n("div#amb_footer_login");e.tag("a.amb_button amb_anchor").button().attr({href:s}).text(t.format(o[i].common.auxiliary.ni,o[i].service)+t.format(o[i].common.execute,o[i].login)).gat()}return e}();f.status.auth||s.loginBtn&&N&&c.append(N);a&&s.util&&c.append(h);if(f.status.auth){!t.os.iosCaApp&&a&&s.actions&&c.append(m);!t.os.iosCaApp&&s.banner&&c.append(g).append(y);!t.os.iosCaApp&&s.naviLove&&c.append(b);A()}s.bar&&c.append(S);s.bar&&S.append(w);s.bar&&S.append(x);s.copy&&c.append(T);l.append(c);f.status.auth&&L()},setNotiSummary:function(e){t.log.debug("Call footer setNotiSummary");this.noti=t(".amb_nav_item.amb_notifications");this.noti.counter=t(".amb_nav_item.amb_notifications span.amb_footer_nav_counter");if(e.summary&&e.summary.unreadCount){var n=e.summary.unreadCount>99?"99+":e.summary.unreadCount;this.noti.counter.text(n).visible(1)}else this.noti.counter.empty().visible(0)},deleteCounter:function(){this.noti.counter.visible(0)},addRecoItems:function(e,s){s=s||{};var a=s.data||[];if(a.length===0)return null;var f=t.storage(r.key.app)||{},l=f.data&&f.data.application&&f.data.application.name||"",c=n("p.amb_header");l?c.tag("span.amb_title").text(l).gat().appendText(o[i].recoApp.forYou+o[i].recoApp.title):c.text(o[i].recoApp.title);var h=n("ul.amb_list");a.forEach(function(e){if(e.status==="open"){var t=e.picture;if(!t){var t=location.protocol==="https:"?r.url.stat_ssl:r.url.stat;t+="/pub/content/"+r.app.jssdk.id+"/img/"+"no_app.png"}h.tag("li.amb_item").tag("a.amb_anchor").button().attr({href:e.url}).tag("i.amb_thumbnail amb_smaller amb_app").css({"background-image":"url("+t+"?option=crop&size="+60*u+")"}).gat().tag("p.amb_tx_link").text(e.name).gat().gat().gat()}});var p=n("a.amb_more_link amb_more amb_anchor").attr({href:r.url.home+"/#apps/all"}).button().tag("span.amb_text").text(t.format(o[i].common.auxiliary.kara,o[i].all+o[i].service)+o[i].search).gat();e.cls("amb_container amb_frame").append(c).append(h).append(p)},addPrText:function(e,t){t=t||{};var r=t.footerText;if(r){var i=n("a#amb_footer_text_pr").cls("amb_anchor amb_tx_link "+r.icon).button().attr({href:r.link}).text(r.text);e.append(i)}}}},M;if(r.dev){M="../../../";M+=r.mode+"/css/all.css";t("head").append(n("link").attr({rel:"stylesheet",href:M}))}else{M=location.protocol==="https:"?r.url.stat_ssl:r.url.stat;M+="/pub/sdk/css/all-"+AMB.VERSION+".css";t("head").append(n("link").attr({rel:"stylesheet",href:M}))}})(window);