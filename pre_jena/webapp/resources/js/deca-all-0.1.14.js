(function(e){e.AMB=e.AMB||{};AMB.VERSION="0.1.14"})(window);(function(e){e.AMB=e.AMB||{};AMB.logLevel=AMB.logLevel||"FATAL";AMB.config={mode:"product",dev:0,key:{me:"_ambme",token:"_ambt",clientId:"_ambcid",fid:"_ambfid",sessionId:"_ambsid",bootstrap:"_ambbs",app:"_ambapp",storage:"_ambstrg",call:"_ambcall",pr:"_ambpr",logLvl:"_ambloglvl",config:"_ambcfg"},fid:{hlogo:"c.amm-header_l.dr-home_r.am-mini",hnoti:"c.amm-header_l.dr-noti_r.am-mini",ftop:"c.amm-footer_l.dr-top_r.am-mini",fhome:"c.amm-footer_l.dr-home_r.am-mini",fcommunity:"c.amm-footer_l.dr-ctop_r.am-mini",fgame:"c.amm-footer_l.dr-gtop_r.am-mini",fnotifications:"c.amm-footer_l.dr-noti_r.am-mini",fcoin:"c.amm-footer_l.dr-coin_r.am-mini",finvitation:"c.amm-footer_l.dr-invitation_r.am-mini",fcontact:"c.amm-footer_l.dr-contact_r.am-mini"},scope:[],url:{home:"https://s.amebame.com",auth:"https://auth.amebame.com",OAuth:"https://oauth.ameba.jp",graph:"https://api.amebame.com/graph",admin:"https://api.amebame.com/operation",tracking:"https://api.amebame.com/track/log",bootstrap:"https://api.amebame.com/bootstrap",stat:"http://stat.amebame.com",stat_ssl:"https://ssl-stat.amebame.com",help_rmt:"http://help.amebame.com/ameba-rules/1295/",payment:"https://payment.amebame.com/coin/"},amebame:{url:{home_header:"http://link.ameba.jp/155220/",top:"http://link.ameba.jp/153804/",home:"http://link.ameba.jp/153805/",game:"http://sr.ca-mpr.jp/s/10/?i4a=586600",community:"http://sr.ca-mpr.jp/s/10/?i4a=586599",payment:"http://link.ameba.jp/157506/",invitation:"https://s.amebame.com/#invitation",contact:"https://s.amebame.com/#contact/app",group:"https://s.amebame.com/#group",notifications:"http://link.ameba.jp/153808/",models:""}},app:{jssdk:{id:"8193"}}}})(window);(function(e){function s(e){return typeof e=="string"||e instanceof String}function o(e){return typeof e=="function"||e instanceof Function}function u(e){return typeof e=="number"||e instanceof Number}function a(e){return e instanceof T}function f(e){return e instanceof Object}function l(e){return e instanceof Array}function c(e){return e===undefined||e===null}function h(e){for(var t in e)return!1;return!0}function p(e){return c(e)?"":e}function d(e){return e.replace(/-([a-z])/g,function(e){return e.toUpperCase().replace("-","")})}function v(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}function m(e,t){return u(t)&&c(r[e])?t+"px":t}function g(e){var t={};for(var n=0;n<e.length;n++)t[e[n]]=1;return t}function y(e){return e?e.replace(/^\s+|\s+$/g,""):""}function b(e){return tag("span").text(e).inner()}function w(e,t,n){if(!n)return;["-webkit-"+t,"-moz-"+t,"-ms-"+t,"-o-"+t,t].forEach(function(t){e[t]=n})}function S(e){return e._cid||(e._cid=++E)}function x(e,t,n){try{var r=new Event(e);r.target=t;return r}catch(i){var s=t instanceof T?t.get(0):null;return{type:e,target:t,currentTarget:s,custom:!0,source:n,stopPropagation:function(){n&&n.stopPropagation()},preventDefault:function(){n&&n.preventDefault()}}}}function T(e,t){s(e)?this.c=t.querySelectorAll(e):l(e)?this.c=e:this.c=[e]}function N(e){return c(e)?null:e instanceof T?e:new T(e,t)}function k(e){return e in C?C[e]:e}function M(e,t,n){this.count=0;this.loop=t||0;this.interval=e||0;this.delay=n||0;this.timerId=0}function D(e,t){var n=(new Error).stack;if(n){var r=n.split(/\n/),i=r[3];if(i){var s=_.exec(i);if(s){var o=s[1];t.push("("+o+")")}}}t.unshift("["+e+"]");N.os.ios||N.os.android?console.log(t.join(" ")):console.log.apply(console,t)}function H(){}var t=e.document,n=e.document.documentElement,r={"column-count":1,columns:1,"font-weight":1,"line-height":1,opacity:1,"z-index":1,zoom:1},i=Array.prototype.slice,E=0,C={added:"DOMNodeInsertedIntoDocument",removed:"DOMNodeRemovedFromDocument"};T.prototype={constructor:T,length:function(){return this.c.length},exist:function(e){var t=this.c;return e>=0&&e<t.length&&(l(t)?!c(t[e]):!c(t.item(e)))},get:function(e){return l(this.c)?this.c[e]:this.c.item(e)},each:function(e){var t=this.c instanceof Array;for(var n=0;n<this.c.length;n++)t?e.call(this.c[n]):e.call(this.c.item(n));return this},find:function(e){var t=[];this.each(function(){var n=this.querySelectorAll(e),r=n.length;for(var i=0;i<r;i++)t.push(n.item(i))});return N(t)},bound:function(e){var n=this.get(0).getBoundingClientRect(),r=e&&e.screen?0:t.body.scrollLeft,i=e&&e.screen?0:t.body.scrollTop;return{left:Math.floor(n.left+r),right:Math.floor(n.right+r),top:Math.floor(n.top+i),bottom:Math.floor(n.bottom+i),width:Math.floor(n.width),height:Math.floor(n.height)}},css:function(e){var t;if(s(e))return this.get(0).style[d(e)]||getComputedStyle(this.get(0),"").getPropertyValue(e);if(arguments.length===0){t={};this.get(0).style.cssText.split(";").forEach(function(e){var n=e.match(/\s*(.+)\s*:\s*(.+)\s*/);n&&(t[n[1]]=n[2])});return t}t="";var n=e.reset;delete e.reset;for(var r in e){var i=v(r);t+=i+":"+m(r,e[r])+";"}this.each(function(){n?this.style.cssText=t:this.style.cssText+=t});return this},hasClass:function(e){if(!this.exist(0))return undefined;var t=!1;this.each(function(){var n=this.className;t=(" "+p(n)+" ").indexOf(" "+e+" ")>=0;return t});return t},cls:function(e){if(c(e)){var t={};this.each(function(){N.merge(t,g(this.className.split(/\s+/g)))});return t}var n=[],r=[],i=0;s(e)?n=[e]:l(e)?n=g(e):N.map(e,function(e,t){t===1?n.push(e):r.push(e)});this.each(function(){var e=g(this.className.split(/\s+/g));for(i=0;i<n.length;i++){var t=n[i];t&&(e[t]=1)}for(i=0;i<r.length;i++)delete e[r[i]];var s="";N.map(e,function(e){s.length===0?s+=e:s+=" "+e});this.className=s});return this},on:function(e,t,n){e=k(e);this.each(function(){function r(e){var n=e.currentTarget,r=t.call(n,e);return r}r._cb=t;r._uc=n;this.addEventListener(e,r,n);var i=this._handlers||(this._handlers={}),s=i[e]||(i[e]=[]);s.indexOf(r)<0?s.push(r):alert(t)});return this},trigger:function(e,t){e=k(e);var n=this,r=x(e,n,t);this.each(function(){if(r.custom){var t=this._handlers;if(t&&e in t){var i=t[e];i.forEach(function(e){return e.call(n,r)})}}else this.dispatchEvent(r)})},off:function(e,t){e=k(e);this.each(function(){var n=this._handlers;if(n&&e in n){var r,i=n[e];if(t){for(r=0;r<i.length;r++)if(i[r]._cb===t){this.removeEventListener(e,i[r],i[r]._uc);i.splice(r,1);i.length===0&&delete n[e];break}}else{for(r=0;r<i.length;r++)this.removeEventListener(e,i[r],i[r]._uc);delete n[e]}}});return this},text:function(e){var t=arguments.length;if(t===0){var n="";this.each(function(){n+=this.textContent});return n}t>1&&(e=N.format.apply(N,arguments));e=e||"";return this.each(function(){this.textContent=e})},value:function(e){var t=this.get(0);if(e!==null&&e!==undefined){t&&(t.value=e);return this}return t?t.value||"":""},checked:function(){var e=this.get(0);return e.checked||!1},parent:function(){var e=this.get(0);return e?N(e.parentNode):null},append:function(e){if(c(e))return this;var t=N(e),n=this.get(0);n&&t.each(function(){n.appendChild(this)});return this},prepend:function(e){if(c(e))return this;var t=N(e),n=this.get(0);n&&t.each(function(){n.childNodes.length>0&&n.firstChild?n.insertBefore(this,n.firstChild):n.appendChild(this)});return this},replace:function(e,t){if(c(e))return this;var n=N(e),r=this.get(0),i=t.get(0);r&&n.each(function(){r.childNodes.length>0&&i&&i.parentNode==r?r.insertBefore(this,i):r.appendChild(this);r.removeChild(i)});return this},remove:function(){this.each(function(){this.parentNode&&this.parentNode.removeChild(this)});return this},empty:function(){return this.inner("")},html:function(){var e=i.apply(arguments);if(e.length===0){var t="";this.each(function(){this.outerHTML&&(t+=this.outerHTML)});return t}return this.each(function(){this.outerHTML=e[0]})},inner:function(){var e=i.apply(arguments);if(e.length===0){var t="";this.each(function(){this.innerHTML&&(t+=this.innerHTML)});return t}return this.each(function(){this.innerHTML=e[0]})},tag:function(e,t){var n=N.tag(e,t);n._p=this;return n},gat:function(){var e=this._p;delete this._p;return e.append(this)},appendText:function(e){this.append(t.createTextNode(e));return this},attr:function(e,t){var n=this,r;if(e===undefined&&t===undefined){if(arguments.length===1)return this;r=n.get(0);var i={};if(r&&r.attributes){var o=r.attributes.length;for(var u=0;u<o;u++){var a=r.attributes[u];i[a.name]=a.value}}return i}if(t===undefined&&f(e))for(var l in e)n.attr(l,e[l]);else{if(s(e)&&t===undefined){r=n.get(0);return r.hasAttribute(e)?r.getAttribute(e):undefined}this.each(function(){c(t)?this.removeAttribute(e):e==="cls"?n.cls(t):this.setAttribute(e,t)})}return this},data:function(e,t){var n=this,r;if(arguments.length===0){var i=this.attr(),o={};for(r in i)r.indexOf("data-")===0&&(o[r.substring(5)]=i[r]);return o}if(arguments.length===1){if(s(e))return this.attr("data-"+e);var u={};for(r in e)u["data-"+r]=e[r];this.attr(u)}else this.attr("data-"+e,t);return this},tap:function(e){var n=this;if(e){n.on("tap",function(t){return e.call(this,t)});if(N.os.touch){var r=null;n.on("touchstart",function(e){r=N(this);r.__tap={};var n=e.changedTouches[0];r.__tap.x=n.clientX;r.__tap.y=n.pageY+t.body.scrollTop}).on("touchmove",function(e){var n=e.changedTouches[0];r.__tap.toX=n.clientX;r.__tap.toY=n.pageY+t.body.scrollTop;var i=r.__tap;if(!(Math.abs((i.toX||i.x)-i.x)<=10&&Math.abs((i.toY||i.y)-i.y)<=10)){r.trigger("tapout",e);return!1}}).on("touchend",function(e){e.preventDefault();e.stopPropagation();var t=r.bound(),n=e.changedTouches[0],i=n.clientX-t.left,s=n.pageY-t.top,o=r.__tap;i>=0&&Math.abs((o.toX||o.x)-o.x)<=5&&Math.abs((o.toY||o.y)-o.y)<=5&&i<=t.width&&s>=0&&s<=t.height&&!r.attr("disabled")&&r.trigger("tap",e);delete r.__tap;r=null})}else n.click(function(e){N(this).trigger("tap",e)})}else n.trigger("tap");return n},over:function(e){function n(e){N(this).trigger("over",e)}var t=this;t.on("over",function(t){var n=this;n.__over=!0;e.call(n,t)});N.os.touch?e?t.on("touchstart",n):n():t.mouseover(n);return t},tapout:function(e){var t=this;t.on("tapout",function(t){var n=this;e.call(n,t)});return t},out:function(e){function n(e){N(this).trigger("out",e)}var t=this;t.on("out",function(t){var n=this;if(n.__over){delete n.__over;e.call(n,t)}});N.os.touch?e?t.on("touchend",n):n():t.mouseout(n);return t},visible:function(e){return this.css({visibility:e?"visible":"hidden"})},disable:function(){function t(e){e.preventDefault()}var e=this;["touchstart","touchend","touchmove","mouseover","mouseout","mousedown","mouseup"].forEach(function(n){e.on(n,t)});return e}};["click","blur","change","error","focus","keydown","keyup","keypress","load","unload","mousedown","mouseup","mousemove","mouseout","mouseover","resize","scroll","select","submit","touchstart","touchmove","touchend"].forEach(function(e){T.prototype[e]=function(t){t?this.on(e,t):this.trigger(e);return this}});var L=navigator.userAgent;N.os={ua:L,touch:"ontouchstart"in document.documentElement,ios:/ip(hone|od|ad)/i.test(L),iphone:/iphone/i.test(L),ipad:/ipad/i.test(L),android:/android/i.test(L),mobile:/android.+mobile|ip(hone|od|ad)/i.test(L),webkit:/webkit/i.test(L)};var A={},O={};N.tag=function(e,n){n=n||{};var r=e.indexOf("#"),i=e.indexOf(".");r>0&&(i>0?n.id=e.substring(r+1,i):n.id=e.substring(r+1));if(i>0){var s=e.substring(i+1).split(".");for(var o=0;o<s.length;o++){var u=s[o];n.cls?n.cls+=" "+u:n.cls=u}}e=r>0?e.substring(0,r):i>0?e.substring(0,i):e;var a=t.createElement(e),f=N(a).attr(n);return f};N.fragment=function(){return N(document.createDocumentFragment())};N.extend=function(e){N.map(e,function(e,t){T.prototype[e]=t})};N.map=function(e,t){if(!e)return;for(var n in e)e.hasOwnProperty(n)&&t.call(e,n,e[n])};N.cookie=function(e,t,n){var r;if(arguments.length===1){var i=document.cookie.split(";");for(var s=0;s<i.length;s++){r=i[s];var o=r.indexOf("="),u=y(r.substring(0,o));if(e===u)return y(r.substring(o+1))}return undefined}r=e+"="+escape(t?t:"");var a=null;if(n){a=new Date;a.setDate(a.getDate()+n)}else t||(a=new Date(0));a&&(r+="; expires="+a.toUTCString());document.cookie=r};N.session=function(e,t){if(arguments.length===1){var n=sessionStorage.getItem(e);return n?JSON.parse(n):null}c(t)?sessionStorage.removeItem(e):sessionStorage.setItem(e,JSON.stringify(t));return this};N.storage=function(e,t){if(arguments.length===1){var n=localStorage.getItem(e);return n?JSON.parse(n):null}c(t)?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t));return this};N.format=function(){var e=arguments;return e[0]?e[0].replace(/\{(\d+)\}/g,function(){return e[arguments[1]]}):null};N.format.digit=function(e,t){e=String(e);if(e==="")return e;var n=e.length;if(n>=t)return e;var r=t-n,i="";for(var s=0;s<r;s++)i+="0";return i+e};N.listenize=function(e){e.prototype.on=function(t,n){P.info("listening",e.name,t);if(f(t))for(var r in t)this.on(r,t[r]);else{this._events||(this._events={});var i=this._events[t];i?i.push(n):this._events[t]=[n]}return this};e.prototype.off=function(t,n){P.info("listening off",e.name,t);var r=this;if(arguments.length===1)delete this._events[t];else if(typeof handler=="function"){var s=this._events[t];if(s){var o=s.indexOf(n);if(o>=0){s.splice(o,1);s.length===0&&delete this._events[t]}}}else{var u=i.apply(arguments);u.forEach(function(e){r.off(e)})}return this};e.prototype.trigger=function(){if(!this._events)return;var t=i.apply(arguments),n=t.shift();P.debug("triggering",e.name,n,t);var r=this._events[n];if(r)for(var s=0;s<r.length;s++){var o=r[s].apply(this,t);if(o===!1||o===1)return!1}return!0}};M.prototype={lastTap:null,paused:!1,executedTime:0,pastFromPrev:0,start:function(){var e=this;e.paused=!1;e.delay>0?e.timerId=setTimeout(function(){e.next()},e.delay):e.next();return e},next:function(){var e=this;if(e.end)return;if(e.paused)return;e.count++;e.executedTime=(new Date).getTime();e.trigger("timer");if(e.loop>0&&--e.loop===0)return;e.timerId=setTimeout(function(){e.next()},e.interval)},pause:function(){this.paused=!0;this.pastFromPrev=(new Date).getTime()-this.executedTime;clearTimeout(this.timerId)},resume:function(){var e=this;this.paused=!1;this.timerId=setTimeout(function(){e.next()},e.interval-e.pastFromPrev)},stop:function(){var e=this;e.end=!0;clearTimeout(e.timerId);return e}};N.listenize(M);N.timer=function(e,t,n){return new M(e,t,n)};N.parseQuery=function(e){if(e===null)return!1;var e=e||location.search;if(!e){var t=location.href,n=t.indexOf("?");e=t.substring(n+1)}e.charAt(0)==="?"&&(e=e.substring(1));var r={},i=e.split("&");for(var s=0;s<i.length;s++){var o=i[s],n=o.indexOf("="),u=[o.substring(0,n),o.substring(n+1)];u.length===2&&(r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]))}return r};N.createQuery=function(e){var t="";for(var n in e)t+=encodeURI(n)+"="+encodeURI(e[n])+"&";return t.slice(0,-1)};N.parseHash=function(e){var e=e||location.hash;if(!e)return!1;e.charAt(0)==="#"&&(e=e.substring(1));var t={},n=e.split("&");for(var r=0,i=n.length;r<i;r++){var s=n[r].split("=");s.length===2?t[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):s.length===1&&(t[decodeURIComponent(s[0])]="")}return t};var _=new RegExp("/([^/]+?:[0-9]+):"),P={debug:function(){D("DEBUG",i.apply(arguments))},info:function(){D("INFO",i.apply(arguments))},warn:function(){D("WARN",i.apply(arguments))},error:function(){D("ERROR",i.apply(arguments))},fatal:function(){D("FATAL",i.apply(arguments))}};N.log=P;N.setLogLevel=function(e){switch(e){case"FATAL":P.error=H;case"ERROR":P.warn=H;case"WARN":P.info=H;case"INFO":P.debug=H;default:}};N.isString=s;N.isObject=f;N.isFunction=o;N.isNumber=u;N.isArray=l;N.isNull=c;e.AMB.chikuwa=N})(window);(function(e){function i(){var e=navigator.userAgent.match(/(OS|Android) ([0-9_\.]+){1,3}/);return parseInt((RegExp.$2.replace(/_|\./g,"")+"00").slice(0,3))}function s(e){for(var n in localStorage)n.indexOf(e)!==-1&&t.storage(n,null)}function o(e){for(var n in sessionStorage)n.indexOf(e)!==-1&&t.session(n,null)}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config,r=t.session(n.key.logLvl)||{};AMB.logLevel=r.value||AMB.logLevel;t.setLogLevel(AMB.logLevel);t.os.version=i();AMB.chikuwa.storage=function(e,n,r){if(arguments.length===1){var i=localStorage.getItem(e);return i?JSON.parse(i):null}if(t.isNull(n))localStorage.removeItem(e);else try{localStorage.setItem(e,JSON.stringify(n))}catch(o){if(o.name!=="QUOTA_EXCEEDED_ERR")throw o;s(r||"_amb")}return this};AMB.chikuwa.session=function(e,n,r){if(arguments.length===1){var i=sessionStorage.getItem(e);return i?JSON.parse(i):null}if(t.isNull(n))sessionStorage.removeItem(e);else try{sessionStorage.setItem(e,JSON.stringify(n))}catch(s){if(s.name!=="QUOTA_EXCEEDED_ERR")throw s;o(r||"_amb")}return this};t.extend({button:function(e,n){var r=this,i=n&&"isTapout"in n&&n.isTapout;this.over(function(e){t(this).cls({amb_tap:1})}).tapout(function(e){i&&t(this).cls({amb_tap:-1})}).out(function(){i||t(this).cls({amb_tap:-1})}).tap(e).css({cursor:"pointer","-webkit-user-select":"none"});return this}})})(window);(function(e){function s(e){var r={client_id:e.clientId||t.storage(n.key.clientId)&&t.storage(n.key.clientId).value||"",response_type:e.response_type||"token",scope:e.scope?e.scope.join(","):n.scope.join(",")};e.state&&(r.state=e.state);r.response_type==="token"&&(r.redirect_uri=encodeURI(location.href));t.session(n.key.fid)&&(r.frm_id=t.session(n.key.fid).value);e.provider_id&&(r.provider_id=e.provider_id);return r}function o(e){var e=e||"access_token";if(t.storage(n.key.storage)){var s=t.storage(n.key.token);i.debug("Get token from storage",s&&s[e]);return s&&s[e]}i.debug("Get token from memory",r[e]);return r[e]}function u(e){if(!e)return!1;if(t.storage(n.key.storage)){i.debug("Set token in storage",e.access_token);t.storage(n.key.token,e)}else{i.debug("Set token on memory",e.access_token);r=e}return!0}function a(){if(t.storage(n.key.storage)){i.debug("Remove token from storage");t.storage(n.key.token)&&t.storage(n.key.token,null);return!0}i.debug("Remove token from memory");r={};return!0}function f(e){var r=n.url.auth+"/authorize?"+t.createQuery(e);return r}function l(e,r,s){function f(e){var n=document.createElement("a");n.href=e;e+=n.search?"&":"?";e+="from=jssdk";t.os.android&&(e+="&now="+(new Date).getTime());return e}function l(){i.debug("HTTP open",e,r);a.open(e,r);var u=s?JSON.stringify(s):null,f=o(),l=t.storage(n.key.clientId),c=t.storage(n.key.sessionId);f&&a.setRequestHeader("Authorization","OAuth "+f);l&&a.setRequestHeader("X-ClientId",l.value);c&&a.setRequestHeader("X-SessionId",c.value);i.debug("XHR send",u,a);a.send(u)}i.debug("HTTP",e,r);var u=this,a=u.xhr=new XMLHttpRequest;r=f(r);var c=t.os.android?3e3:1e4,h=0;a.timerId=setTimeout(function(){i.debug("HTTP timeout",e,r);a.abort();u.trigger("loaded",a);u.trigger("error",{code:"timeout",message:"timeout"})},c);a.onreadystatechange=function(){if(h===4)return;var s=a.readyState;h=s;i.debug("xhr state",s,s===4);if(s===4){var o=a.status;i.debug("xhr status",o,e,r,a.responseText);if(o===0){i.debug("xhr status aborted");return}clearTimeout(a.timerId);var f;i.debug("xhr response text",a.responseText);a.responseText.charAt(0)==="{"?f=JSON.parse(a.responseText):f=a.responseText;i.debug("xhr response object",f);var l;if(200<=o&&o<300){i.debug("HTTP OK",e,r,a);l="complete"}else{i.error("HTTP",a.statusText,e,r);t.session(n.key.bootstrap)&&t.session(n.key.bootstrap,null);l="error"}u.trigger(l,f)}else if(s<4){var c=["init","loading","loaded","interactive"][s];i.debug("HTTP state type",c,e,r);u.trigger(c,a)}};setTimeout(l,0)}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config,r={},i=t.log;AMB.configure=function(e){i.debug("Begin to configure");var e=e||{},r=t.storage(n.key.clientId)||{},s=e.clientId||"",a=o(),f=e.token||"",l=e.storage?e.storage:0,c=e.sessionId||"",h=e.redirectUrl||"";if(l)t.storage(n.key.storage,{value:!0});else{t.storage(n.key.storage)&&t.storage(n.key.storage,null);t.storage(n.key.token)&&t.storage(n.key.token,null)}s&&r.value!==s&&t.storage(n.key.clientId,{value:s});f&&a!==f&&u({access_token:f});e.scope&&(AMB.config.scope=e.scope);c&&t.storage(n.key.sessionId,{value:c});var p={redirectUrl:h};t.storage(n.key.config,p)};AMB.bootstrap=function(e){i.debug("Begin to bootstrap");AMB.track.action({name:"call"});var r=o();if(r){i.debug("Bootstrap, has token");var s=n.url.graph+"?ids=me,app&fields=id,gender,category";t.http.get(s).on({complete:function(r){i.info("bootstrap, authorized");var r=r||{};r.me=r.me||{};var s={g:r.me.gender?1:0,app:{id:r.app?r.app.id:"",category:r.app?r.app.category:""}};i.debug("set owner data",s);t.storage(n.key.me,s);t.session(n.key.bootstrap)||AMB.bootstrapApi();e({auth:1})},error:function(t){i.info("bootstrap, NOT authorized");e({auth:0})}})}else{i.info("bootstrap, no token");e({auth:0})}};AMB.status=function(e){if(!o()){i.debug("User Status, NOT authorized because of not having token");e({auth:0});return}var r=n.url.graph+"/me?fields=id";t.http.get(r).on({complete:function(t){i.debug("User Status, authorized");e({auth:1})},error:function(t){i.debug("User Status, NOT authorized",t.status,t.message);e({auth:0})}})};AMB.logout=function(e){var e=e||o(),r=function(){i.error("Logout failed")};e||r();t.storage(n.key.me,null);a();var s=n.url.home+"/logout?access_token="+e;s+="&callback="+encodeURI(location.href);location.href=s};AMB.authorize=function(e){var e=e||{},t=s(e);i.debug("Redirect to authorize",f(t));location.href=f(t)};t.listenize(l);t.http={get:function(){var e=Array.prototype.slice.apply(arguments),t=e[0],n=e[1];if(e.length===3){t=t+"?"+query(e[1]);n=e[2]}return new l("GET",t,null,n)},post:function(e,t,n){return new l("POST",e,t,n)},put:function(e,t,n){return new l("PUT",e,t,n)},del:function(e,t){return new l("DELETE",e,t)}};var c=t.parseHash();if(c.access_token){i.debug("Catch a token from the query?",c.access_token);var h={};h.access_token=c.access_token;u(h)&&(t.storage(n.key.storage)&&t.storage(n.key.storage).value?location.replace(location.protocol+"//"+location.host+location.pathname):location.hash="")}})(window);(function(e){function r(e){var t=n.url.graph+e;return t}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config;AMB.api=function(e,n){var i=r(e);t.http.get(i).on({complete:function(e){n(e)},error:function(e){n(null,e)}})};AMB.api.get=AMB.api;AMB.api.post=function(e,n,i){var s=r(e);t.http.post(s,n).on({complete:function(e){i(e)},error:function(e){i(null,e)}})};AMB.api.put=function(e,n){var i=r(e);t.http.put(i).on({complete:function(e){n(e)},error:function(e){n(null,e)}})};AMB.api.del=function(e,n){var i=r(e);t.http.del(i).on({complete:function(e){n(e)},error:function(e){n(null,e)}})}})(window);(function(e){function r(){var e=n.url.bootstrap+"/associate";t.session(n.key.fid)&&t.session(n.key.fid).value&&(e+="?fid="+t.session(n.key.fid).value);t.log.info("Bootstrap API, begin to associate",e);t.http.post(e).on({complete:function(e){t.log.info("Bootstrap API, associated");t.session(n.key.bootstrap,{associated:1})}})}function i(){var e=t.storage(n.key.config)&&t.storage(n.key.config).redirectUrl||location.href,r={callback:encodeURI(e)};t.log.info("Bootstrap API, begin to register",r);location.href=n.url.home+"/#register?"+t.createQuery(r)}function s(e){switch(e){case"unregistered":i();break;case"unassociated":r();break;default:t.session(n.key.bootstrap,{associated:1})}}function o(e){var r=n.url.bootstrap;t.http.get(r+"/status").on({complete:function(n){t.log.debug("Bootstrap status",n);e(n)},error:function(t){e(null,t)}})}function u(){var e=[];o(function(t){for(var n in t)e.push(n);s(e.shift())})}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config;AMB.bootstrapApi=u;t.session(n.key.bootstrap)||AMB.status(function(e){e.auth&&u()})})(window);(function(e){function s(){var e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}if(!AMB)return;var t=AMB.chikuwa,n=AMB.config;AMB.track={action:function(e,t){e=e||{};var n=e.name||"",r=e.option||"",s=e.vars||{},o=new i(n,r,s);o.track(t)}};AMB.tracker=function(){var e=Array.prototype.slice.apply(arguments);return r[e.shift()].apply(this,e)};var r={action:function(){var e=Array.prototype.slice.apply(arguments),t=new i(e.shift(),e.join(","));t.track()},call:function(){var e=new i("call");e.track()}},i=function(e,n,r){this.name=e||"";this.vars=r||{};n&&(t.isString(n)?this.option=n:t.isArray(n)&&(this.option=n.join(",")))};i.prototype={track:function(e){var r=this,i=r.createParams(),s=t.createQuery(i),o=n.url.tracking+"?"+s;try{t.http.get(o).on({complete:function(){t.log.info("tracking OK",i);t.isFunction(e)&&e(null,i)},error:function(n){t.log.info("tracking ERROR",i);t.isFunction(e)&&e(n,i)}})}catch(u){t.log.info("tracking ERROR",u)}},createParams:function(){var e=t.session(n.key.fid)||{},r={action:this.name,tz:(new Date).getTimezoneOffset(),lang:navigator.language,platform:navigator.platform,referrer:encodeURIComponent(document.referrer),url:encodeURIComponent(location.href),option:this.option||"",fid:e.value||"",var1:this.vars.var1||"",var2:this.vars.var2||"",var3:this.vars.var3||"",var4:this.vars.var4||"",var5:this.vars.var5||""};return r}};t.storage(n.key.sessionId)||t.storage(n.key.sessionId,{value:s()});var o=t.parseQuery();o&&o.frm_id&&t.session(n.key.fid,{value:o.frm_id})})(window);(function(e){function f(){l(function(e){if(!e){s.stop();return}a.header&&m.header.setNotiSummary(e);a.footer&&m.footer.setNotiSummary(e)})}function l(e){AMB.api("/me/notifications?summaryOnly=true",function(t){t?e(t):e(null)})}function c(){s||(s=t.timer(r.noti.interval,0,r.noti.interval));s.on("timer",function(){f()});s.start()}function h(){return t.storage(r.key.app)?t.storage(r.key.app).id:""}function p(e){return e+"-"+h()}function d(e,n){function i(e,n){for(var r in n)e[r]?e[r]=e[r]+"_"+n[r]:e[r]=n[r];return t.createQuery(e)}if(!e)return!1;if(!n)return e;var r=document.createElement("a");r.href=e;if(r.host==="link.ameba.jp"){r.pathname+=t.createQuery(n);return r.href}if(r.search){r.search=i(t.parseQuery(r.search),n);return r.href}r.search=t.createQuery(n);return r.href}function v(){var e,n,r;if(arguments.length===1){n=t.storage(arguments[0])||{};if((new Date).getTime()<n.expireIn)return n.data;t.storage(arguments[0],null);return!1}if(arguments.length===2)t.storage(arguments[0],null);else if(arguments.length===3){e=arguments[0];n=arguments[1];r=arguments[2];t.storage(e,{expireIn:(new Date).getTime()+r,data:n})}return!1}if(!AMB)return;var t=AMB.chikuwa,n=t.tag,r=AMB.config,i="ja",s="",o={ja:{contact:"お問い合わせ",models:"対応端末",payment:"コインを購入",invite:"友だち招待",top:"Ameba",home:"ホーム",game:"ゲーム",community:"コミュニティ",notifications:"お知らせ",noNoti:"お知らせはありません",close:"閉じる",more:"もっと見る",loading:"読み込み中...",help:{rmt:"禁止行為について"},common:{to:"{1}へ"},date:{format:{MD:"{1}月{2}日"}},naviLove:{title:"あなたはどんな恋がしたい？"}}},u=function(){var e=window.devicePixelRatio||1;return e>1.5?2:e>1?1.5:1}();r.noti={};r.noti.interval=r.dev?1e4:18e4;r.path={fun:"/frames?type=fun&location=footer",footerText:"/frames?type=text&location=footer",pickUpText:"/frames?type=app&location=general_pickup"};t.os.caApp=/CaWebApp/i.test(t.os.ua);t.os.iosCaApp=t.os.ios&&t.os.caApp;var a={footer:0,header:0};AMB.ui=function(){var e=Array.prototype.slice.apply(arguments),t=e.shift();return m[t].init.apply(m[t],e)};AMB.footer=function(e,t){AMB.ui("footer",e,t)};AMB.header=function(e,t){AMB.ui("header",e,t)};var m={header:{init:function(e,t){a.header=1;this.element=e;this.options=t;this.isNotiOpen=0;this.btnNoti=n("button#amb_noti").cls("amb_button");this.notiCounter=n("span.amb_header_noti_counter");this.notiContainer=n("div.amb_noti_container");this.notiWrap=n("div.amb_noti_wrap");this.loading=n("p.amb_loading").text(o[i].loading);this.notiNone=n("div.amb_none").tag("p.text").text(o[i].noNoti).gat();this.notiLoading=n("p.amb_loading").text(o[i].loading);this.notiList=n("div.amb_list_container");this.render()},render:function(){var e=this,s=t(this.element);if(!s)return;var u=this.options||{},a=u.template||"default";a="amb_"+a;var l=t.isNull(u.prepend)?1:u.prepend,h=n("header#amb_header").cls(a+" amb").tag("p#amb_ci").tag("a.amb_anchor amb_ci_text").button().attr({href:d(r.amebame.url.home_header,{frm_id:p(r.fid.hlogo)})}).text(t.format(o[i].common.to,o[i].home)).gat().gat();this.btnNoti.button(function(){location.href=d(r.amebame.url.notifications,{frm_id:p(r.fid.hnoti)})});var v=this.btnNoti;v.append(this.notiCounter.visible(0));l?s.prepend(h):s.append(h);h.append(v);if(!status.footer){f();c()}},deleteCounter:function(){this.notiCounter.text("").visible(0)},setNotiSummary:function(e){t.log.debug("Call header setNotiSummary");var n=this;if(e.summary&&e.summary.unreadCount){var r=e.summary.unreadCount>=10?"+":e.summary.unreadCount;this.notiCounter.text(r).visible(1)}else this.deleteCounter()}},footer:{init:function(e,t){var n=this;a.footer=1;this.element=e;this.options=t;this.noti;n.render()},setNotiSummary:function(e){t.log.debug("Call footer setNotiSummary");this.noti=t(".amb_nav_item.amb_notifications");this.noti.counter=t(".amb_nav_item.amb_notifications span.amb_footer_nav_counter");if(e.summary&&e.summary.unreadCount){var n=e.summary.unreadCount>99?"99+":e.summary.unreadCount;this.noti.counter.text(n).visible(1)}else this.noti.counter.empty().visible(0)},deleteCounter:function(){this.noti.counter.visible(0)},getPrData:function(e){var n=v(r.key.pr);if(n)e(n);else{var i={},s=h(),o=function(e){if(!r.path[e])return!1;var t=r.url.admin+r.path[e];s&&(t+="&app_id="+s);return t},u=o("fun");t.http.get(u).on({complete:function(n){i.fun=n.data;u=o("footerText");t.http.get(u).on({complete:function(n){i.footerText=n.data;u=o("pickUpText");t.http.get(u).on({complete:function(t){i.pickUpText=t.data;v(r.key.pr,i,y*15);e(i)},error:function(t){i.pickUpText="";e(i,t)}})},error:function(t){i.footerText="";e(i,t)}})},error:function(t){e(null,t)}})}},selectPrData:function(e){function s(e,t){e||(e="");return e.indexOf(t)>=0}function o(e,t){return e.target.appId===t.appId}function u(e,t){return s(e.target.devices,t.device)}function a(e,t){return t.gender?s(e.target.genders,t.gender):!0}function f(e){return e.target.portal?e.target.portal.indexOf("mini")>=0:!0}function l(e,n){if(!(e&&e.target&&e.target.time))return!1;var r=t.date.parseISO8601(e.target.time.start).getTime(),i=t.date.parseISO8601(e.target.time.end).getTime(),n=n||(new Date).getTime();return r<=n&&n<i}function c(e,n){var r=a(e,n)&&u(e,n)&&!o(e,n)&&l(e)&&f(e);t.log.debug("PR isMatch",r,a(e,n),u(e,n),!o(e,n),l(e),f(e),e,n);return r?!0:!1}function h(e){var e=e||[],r=[];e.forEach(function(e){c(e,n)&&r.push(e)});var i=r[parseInt(Math.random()*r.length)]||"";t.log.debug("selected",i);return i}var e=e||{},n={};n.gender=t.storage(r.key.me)?t.storage(r.key.me).g||"":"";n.gender===0?n.gender="female":n.gender===1&&(n.gender="male");t.os.caApp?n.device=t.os.ios?"iosApp":t.os.android?"androidApp":"":n.device=t.os.ios?"ios":t.os.android?"android":"";t.storage(r.key.me)&&t.storage(r.key.me).app&&t.storage(r.key.me).app.id?n.appId=t.storage(r.key.me).app.id:n.appId=null;var i={};i.fun=h(e.fun);i.footerText=h(e.footerText);i.pickUpText=h(e.pickUpText);return i},render:function(){function B(e,s){t.isArray(s)||(s=selectNav());t("#amb_nav")&&t("#amb_nav").remove();var u=n("nav#amb_nav"),a=n("ul.amb_nav_list");s.forEach(function(e){var t=n("li.amb_nav_item amb_"+e).tag("a.amb_anchor").button().attr({href:d(r.amebame.url[e],{frm_id:p(r.fid["f"+e])})}).tag("span.amb_label").text(o[i][e]).gat().gat();e==="notifications"&&t.tag("span.amb_footer_nav_counter").visible(0).gat();a.append(t)});u.append(a);e.append(u)}var e=this,s=t(this.element);if(!s)return;var a=t.storage(r.key.clientId)?t.storage(r.key.clientId).value:"",l=this.options||{},v=t.isNull(l.util)?1:l.util,m=t.isNull(l.actions)?1:l.actions,g=t.isNull(l.payment)?1:l.payment,y=t.isNull(l.invite)?1:l.invite,b=t.isNull(l.banner)?1:l.banner,w=t.isNull(l.bar)?1:l.bar,E=t.isNull(l.copy)?1:l.copy,S="game";t.storage(r.key.me)&&t.storage(r.key.me).app&&(S=t.storage(r.key.me).app.category||"game");l.category&&(S=l.category==="community"?"community":"game");if(!t.isNull(l.invitationUrl)&&l.invitationUrl.match(/^http(s)?(:\/\/[-_.!~*\'()a-zA-Z0-9;\/?:\@&=+\$,%#]+)$/))var x=l.invitationUrl;else{var x=r.amebame.url.invitation+"/external/app/"+a;x+="?callback="+encodeURI(location.href)}x=d(x,{frm_id:p(r.fid.finvitation)});var T=t.isNull(l.naviLove)?0:l.naviLove;T&&(b=0);var N=t.isNull(l.steadyBanner)?0:l.steadyBanner;N&&(b=0);var C=n("div#amb_footer").cls("amb"),k=n("ul#amb_footer_utility");a&&k.tag("li.amb_utility_item").tag("a.amb_anchor amb_tx_link").button().attr({href:d(r.amebame.url.contact+"/"+a,{frm_id:p(r.fid.fcontact,h()),callback:encodeURI(location.href)})}).text(o[i].contact).gat().gat();S==="game"&&k.tag("li.amb_utility_item").tag("a.amb_anchor amb_tx_link").button().attr({href:r.url.help_rmt}).text(o[i].help.rmt).gat().gat();var L=n("ul#amb_footer_usr_action");L.payment=n("li.amb_action_item");L.payment.tag("button#amb_footer_btn_coin"
).cls("amb_button").text(o[i].payment).button(function(){var e=r.url.payment;location.href=e}).gat();g&&L.append(L.payment);if(a&&y){L.invite=n("li.amb_action_item");L.invite.btn=n("button#amb_footer_btn_friend").cls("amb_button").text(o[i].invite);L.invite.append(L.invite.btn);L.invite.btn.button(function(){location.href=x});L.append(L.invite)}var A=n("div#amb_footer_pr_box"),O=n("div#amb_footer_fun_box"),M=n("div.pickUpTextWrap");b&&e.getPrData(function(s){if(s){var o=e.selectPrData(s);if(o.footerText){var a=n("p"),f="amb_new";if(o.footerText.body.options){f=t.isObject(o.footerText.body.options)?o.footerText.body.options[0]:o.footerText.body.options;f="amb_"+f}var l=n("a#amb_footer_text_pr").cls("amb_anchor amb_tx_link "+f).button().attr({href:o.footerText.body.link}).text(o.footerText.body.message[i]);a.append(l);A.append(a)}if(o.fun){var c=location.protocol==="https:"?r.url.stat_ssl:r.url.stat;c+=o.fun.body.image+"?option=crop&size="+60*u;var v="amb_star";if(o.fun.body.options){v=t.isObject(o.fun.body.options)?o.fun.body.options[0]:o.fun.body.options;v="amb_"+v}var m=n("a.amb_anchor").button().attr({href:o.fun.body.link}),g=n("i").cls("amb_thumbnail amb_smaller app").css({"background-image":"url("+c+")"}),y=n("div#amb_footer_fun_detail"),b=n("p").cls("amb_title "+v).text(o.fun.body.title[i]),w=n("p.amb_msg").text(o.fun.body.description[i]);y.append(b).append(w);m.append(g).append(y);O.append(m)}if(o.pickUpText){function E(e){if(!(e&&e.body&&e.target))return!1;var t=e.body.portalTo,n=t==="game"?r.amebame.url.game:r.amebame.url.community,i={frm_id:p(r.fid["f"+t],h())};e.target.mapping&&(i.pickup_id=e.id);return d(n,i)}function S(e){if(!(e&&e.body&&e.body.portalTo))return!1;t("#amb_nav .amb_nav_item.amb_"+e.body.portalTo+" > a").attr({href:E(e)})}M.tag("div#amb_footer_pickUpText").cls("amb_"+o.pickUpText.body.portalTo).button().tag("a.amb_anchor amb_message").attr({href:E(o.pickUpText)}).text(o.pickUpText.body.message[i]).gat().gat();S(o.pickUpText)}else M.remove()}});var _=function(){var e=[{image:"/pub/content/{1}/img/love/thumb_130226_1.jpg",link:"http://sr.ca-mpr.jp/s/10/?i4a=623288",title:{ja:"セレブな恋"}},{image:"/pub/content/{1}/img/love/thumb_130226_2.png",link:"http://sr.ca-mpr.jp/s/10/?i4a=623286",title:{ja:"甘い恋"}},{image:"/pub/content/{1}/img/love/thumb_130226_3.jpg",link:"http://sr.ca-mpr.jp/s/10/?i4a=623287",title:{ja:"刺激的な恋"}},{image:"/pub/content/{1}/img/love/thumb_130226_4.png",link:"http://sr.ca-mpr.jp/s/10/?i4a=623289",title:{ja:"泣ける恋"}}],s=n("div#amb_naviLove").cls("amb_container amb_frame"),a=n("p.amb_sc_h").text(o[i].naviLove.title),f=n("ul");e.forEach(function(e){var s=location.protocol==="https:"?r.url.stat_ssl:r.url.stat;s+=t.format(e.image,r.app.jssdk.id)+"?option=crop&size="+60*u;f.append(n("li").tag("a.amb_anchor").button().attr({href:e.link+p("&frm_id=c.amm-footer_l.dr-love-char_r.am-mini")}).tag("i").css({"background-image":"url("+s+")"}).cls("amb_thumbnail amb_smaller amb_app").gat().tag("p.amb_tx_link").text(e.title[i]).gat().gat())});var l=n("a.amb_more_link amb_more amb_anchor").attr({href:"http://sr.ca-mpr.jp/s/10/?i4a=623738"+p("&frm_id=c.amm-footer_l.dr-love-char_r.am-mini")}).button().tag("span.amb_text").text(o[i].more).gat();s.append(a).append(f).append(l);return s}(),D=function(){var e={fun:{body:{image:"/pub/content/{1}/img/coincp/thumb_0226_coin.png",link:"http://s.game.ameba.jp/game-campaign?id=201213_0129_coin",title:{ja:"【1900コイン】即ゲット♪"},description:{ja:"BIGチャンス到来！お得にコインをもらってゲームで遊ぼう★"}}}},s=location.protocol==="https:"?r.url.stat_ssl:r.url.stat;s+=t.format(e.fun.body.image,r.app.jssdk.id)+"?option=crop&size="+60*u;var o="amb_coin",a=n("a.amb_anchor").button().attr({href:e.fun.body.link}),f=n("i").cls("amb_thumbnail amb_smaller app").css({"background-image":"url("+s+")"}),l=n("div#amb_footer_fun_detail"),c=n("p").cls("amb_title "+o).text(e.fun.body.title[i]),h=n("p.amb_msg").text(e.fun.body.description[i]);l.append(c).append(h);a.append(f).append(l);return a}(),P=n("div#amb_navWrap"),H=n("p#amb_copyright").text("© CyberAgent, Inc.");a&&v&&C.append(k);!t.os.iosCaApp&&a&&m&&C.append(L);b&&C.append(A).append(O);!t.os.iosCaApp&&N&&C.append(O.append(D));!t.os.iosCaApp&&T&&C.append(_);w&&C.append(P);w&&P.append(M);w&&B(P,["home","game","community","notifications"]);E&&C.append(H);s.append(C);f();c()}}},g=1e3,y=6e4,b=y*60,w=b*24;t.date={parseISO8601:function(e,t){if(!e)return null;if(typeof t=="undefined"){var n=(new Date).getTimezoneOffset()*-1/60;t=Number(n)}e=e.replace(/Z|T/g,"");var r=b*t,i=e.match(/([\d]{4})-([\d]{2})-([\d]{2}).*([\d]{2}):([\d]{2}):([\d]{2})/),s={y:Number(i[1]),m:Number(i[2]),d:Number(i[3])},o={h:Number(i[4]),m:Number(i[5]),s:Number(i[6])},u=new Date(s.y,s.m-1,s.d,o.h,o.m,o.s);r!==0&&u.setTime(u.getTime()+r);return u}};if(r.dev){var E="../../../";E+=r.mode+"/css/all.css";t("head").append(n("link").attr({rel:"stylesheet",href:E}))}else{var E=location.protocol==="https:"?r.url.stat_ssl:r.url.stat;E+="/pub/sdk/css/all-"+AMB.VERSION+".css";t("head").append(n("link").attr({rel:"stylesheet",href:E}))}})(window);